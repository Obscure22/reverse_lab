<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obscure RE and MA Dojo</title>
    
    <!-- link to fontawesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- link to css file -->
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
      <a href="/reverse_lab" class="logo">Obscure_</a>
          <ul class="nav-links">
              <li><a href="../ctf_reversing/re.html">CTF Reverse Engineering</a></li>
          </ul>
    </nav>
    <section class="container">
        <section class="container-title">
            <h1>Reversing ELF - TryHackMe</h1>
            <div class="post__bottom">
                <div class="post__author">
                    <a href="#" aria-label="ObscureRe">
                        <img class="post__author-image" src="../../img/logo.png"
                            alt="Obscure's Picture">
                    </a>
                </div>
                <span>
                    Obscure_ &nbsp;·&nbsp; <span id="reading-time"></span>
                </span>
            </div>
        </section>
        <section>
            <h2>Introduction</h2>
            <p>
                This write-up covers the <strong>Reversing ELF</strong> challenge from <strong>TryHackMe</strong>, which consists of 8 ELF crackme binaries. Time to roll up our sleeves and start reversing.
            </p>
        </section>
        <section>
            <h2>Crackme1</h2>
                <p>
                    After opening the binary in <strong>IDA</strong>, the first notable observation is the allocation of a buffer containing encrypted character data. 
                    This buffer appears to store obfuscated strings that are later decrypted at runtime. Subsequently, a call to <span id="inline-code">memset</span> is performed, 
                    which overwrites 27 bytes of the allocated buffer with the character <strong>A</strong> (<span id="inline-code">0x41</span>).
                    <br>
                    <img src="../../img/re_crackme/crackme1_1.png" alt="crackme1_1" onclick="window.open(this.src, '_blank');"
                            width="650", onmouseover="this.style.cursor='zoom-in'"
                            onmouseout="this.style.cursor='default'">
                    <br><br>
                    Next, a loop iterates over the encrypted array 26 times (as indicated by the comparison <span id="inline-code">cmp eax, 1Ah</span>). During each iteration, the data is progressively 
                    processed to recover the original content. Once the loop completes, the resulting decrypted string is printed to standard output using the <span id="inline-code">puts</span> function.
                    <br>
                    <img src="../../img/re_crackme/crackme1_2.png" alt="crackme1_2" onclick="window.open(this.src, '_blank');"
                            width="650", onmouseover="this.style.cursor='zoom-in'"
                            onmouseout="this.style.cursor='default'">
                    <br><br>
                    Therefore, by executing the program within <strong>IDA</strong> and placing a breakpoint on the puts function, it is possible to inspect the contents of the 
                    <span id="inline-code">RAX</span> register at runtime and directly observe the decrypted string in cleartext. Alternatively, simply running the binary from 
                    the terminal is sufficient to display the decrypted string, as it is printed to standard output.
                    <br>
                    <img src="../../img/re_crackme/crackme1_3.png" alt="crackme1_3" onclick="window.open(this.src, '_blank');"
                            width="650", onmouseover="this.style.cursor='zoom-in'"
                            onmouseout="this.style.cursor='default'">
                    <br><br>
                </p>
            <h2>Crackme2</h2>
                <p>
                    In this second scenario, as shown in the figure below, the program first performs a comparison between the value pointed to by <span id="inline-code">EAX</span> and 2. 
                    This indicates that the program expects one command-line argument; if this condition is not met, it prints the message <span id="inline-code">Usage: %s password</span> and 
                    terminates. This behavior confirms that the program requires a password as the second command-line parameter, although the correct value is not immediately known.
                    <br>
                    <img src="../../img/re_crackme/crackme2_1.png" alt="crackme2_1" onclick="window.open(this.src, '_blank');"
                            width="650", onmouseover="this.style.cursor='zoom-in'"
                            onmouseout="this.style.cursor='default'">
                    <br><br>
                    Analysis then focuses on the right execution branch, where the password string is retrieved from the <span id="inline-code">.rodata</span> section and compared against 
                    the user-supplied input stored in <span id="inline-code">EAX</span>. If the comparison succeeds, 0 is stored in <span id="inline-code">EAX</span>, and execution proceeds
                    to the right branch, where the message <strong>Access granted</strong> is displayed. Otherwise, execution follows the left branch, resulting in the message 
                    <strong>Access denied</strong>.
                    <br>
                    <img src="../../img/re_crackme/crackme2_2.png" alt="crackme2_2" onclick="window.open(this.src, '_blank');"
                            width="650", onmouseover="this.style.cursor='zoom-in'"
                            onmouseout="this.style.cursor='default'">
                    <br><br>
                    In conclusion, it can be stated with certainty that the correct password is the one stored in the <span id="inline-code">.rodata</span> section, as illustrated in the figure below.
                    <br>
                    <img src="../../img/re_crackme/crackme2_3.png" alt="crackme2_3" onclick="window.open(this.src, '_blank');"
                            width="650", onmouseover="this.style.cursor='zoom-in'"
                            onmouseout="this.style.cursor='default'">
                    <br><br>
                    By executing the program and providing the extracted password, the flag is successfully obtained.
                    <br>
                    <img src="../../img/re_crackme/crackme2_4.png" alt="crackme2_4" onclick="window.open(this.src, '_blank');"
                            width="650", onmouseover="this.style.cursor='zoom-in'"
                            onmouseout="this.style.cursor='default'">
                    <br><br>
                </p>
            <h2>Crackme3</h2>
                <p>
                    The program first performs the same comparison observed previously, confirming that it expects a password to be provided as a command-line parameter before proceeding 
                    with execution.
                    <br>
                    <img src="../../img/re_crackme/crackme3_1.png" alt="crackme3_1" onclick="window.open(this.src, '_blank');"
                            width="650", onmouseover="this.style.cursor='zoom-in'"
                            onmouseout="this.style.cursor='default'">
                    <br><br>
                    Following the right execution branch, several operations are performed. The user input string, stored in <span id="inline-code">EDI</span>, is retrieved, and memory is 
                    allocated using <span id="inline-code">malloc</span> based on the length of the input. If the memory allocation succeeds, execution continues into the left branch, 
                    where <span id="inline-code">strlen</span> is invoked twice. Before the second <span id="inline-code">strlen</span> call, the function <strong>sub_80486B0</strong> is executed. 
                    This subroutine applies an encryption routine to the input string. The encrypted string is then passed to the second <span id="inline-code">strlen</span>, which computes its length.
                    If the resulting length is not equal to 64 bytes (<span id="inline-code">0x40</span> in hexadecimal), execution follows the right branch and the program prints the message:
                    “Come on, even my aunt Mildred got this one!”.
                    <br>
                    <img src="../../img/re_crackme/crackme3_2.png" alt="crackme3_2" onclick="window.open(this.src, '_blank');"
                            width="650", onmouseover="this.style.cursor='zoom-in'"
                            onmouseout="this.style.cursor='default'">
                    <br><br>
                    If the length check succeeds, execution continues along the left branch. As illustrated in the figure below, this branch references a string stored in the
                    <span id="inline-code">.rodata</span> section at address <span id="inline-code">0x08048E8B</span>. This string appears to be encrypted. The program then calls 
                    <span id="inline-code">strcmp</span>, comparing the encrypted user input (stored in <span id="inline-code">ESI</span>) with this encrypted reference string. 
                    If the comparison returns 0, indicating that the two strings are equal, execution proceeds to the branch, where a call to <span id="inline-code">puts</span>
                    prints the message “Correct password!”.
                    <br>
                    <img src="../../img/re_crackme/crackme3_3.png" alt="crackme3_3" onclick="window.open(this.src, '_blank');"
                            width="650", onmouseover="this.style.cursor='zoom-in'"
                            onmouseout="this.style.cursor='default'">
                    <br><br>
                </p>
        </section>
    </section>

    <script src="../../js/reading-time.js"></script>
</body>
</html>
